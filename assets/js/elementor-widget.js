(()=>{"use strict";const e=window.jQuery;function t(t,n=!0){let o=t;t.nodeType&&(o=e(t)),"object"===e.type(o)&&(o.hasClass("notice")||(o=o.find(".notice"),o.length))&&n!==!o.hasClass("is-hidden")&&(n?(o=e(t).removeClass("is-hidden"),o.hide(),o.fadeIn(2e3)):(o.addClass("is-hidden"),o.fadeOut(2e3,(function(){o.hide()}))))}const n=window.elementor,o=window.ajaxurl,i=window.jQuery;window.$e,window.TEAMTALLY||(window.TEAMTALLY={SHARED_DATA:{}});const a=window.TEAMTALLY.SHARED_DATA,s=a.widget_name;window.TEAMTALLY[s]||(window.TEAMTALLY[s]={}),n.hooks.addAction(`panel/open_editor/widget/${s}`,(function(n,l,c){let r;const m={activate:e=>{const t=(e=!0,t=null)=>{t||(t=p("chosen_template"));const n=t.$el.find("select");e?(t.$el.addClass("is-pending"),n.attr("disabled","disabled")):(t.$el.removeClass("is-pending"),n.removeAttr("disabled"))};if(!e.isOpened)return;const n=p("use_template_tab");if(!n)return;const a=p("chosen_template");if(t(!1,a),!n.$el.hasClass("elementor-tab-active"))return;t(!0,a);const c=l.getSetting("chosen_template");m.updateTemplatesList(null),i.ajax({url:o,method:"POST",data:{action:"elementor_get_all_templates",widget_name:s}}).done((e=>{e.success?m.updateTemplatesList(e.templates,c):m.showTemplateNotice("notice-error","ERROR: Can not load the list of templates"),t(!1,a)}))},showTemplateNotice:(o,i)=>{if("template_section"!==n.currentPageView.activeSection)return;const a=p("template_admin_notice");a&&function(n,o,i="notice-success",a=!1,s=5e3){let l=n;if(n.nodeType&&(l=e(n)),"object"!==e.type(l))return;if(!l.hasClass("notice")&&(l=l.find(".notice"),!l.length))return;const c=l.find("p");c.length&&(c.text(o),a?l.addClass("is-dismissible"):l.removeClass("is-dismissible"),l.removeClass("notice-success notice-error"),l.addClass(i),t(l,!0),s&&setTimeout((()=>{t(l,!1)}),s))}(a.$el,i,o,!0)},updateTemplatesList:(e,t="")=>{if("template_section"!==n.currentPageView.activeSection)return;const o=p("chosen_template");if(!o)return;const i=o.model,a=(o.$el.find("select"),o.getControlValue());if(i.set("options",{}),o.setValue(""),!e||!e.length)return;let s=t||a,l={};e.forEach((e=>{l[e]=e})),i.set("options",l);const c=~e.indexOf(s)?s:e[0];o.setValue(c),o.render()},enableTemplateEditing(e=!0){if("template_section"!==n.currentPageView.activeSection)return;const t=i(".elementor-control-template_pending");if(!t.length)return;const o=p("template_btn_save").$el;if(!o.length)return;const a=t.offset(),s=o.offset().top-a.top+o.height()+parseInt(t.css("padding-top"))+parseInt(t.css("padding-bottom"))+20;t.css("height",s+"px"),e?t.removeClass("is-pending spinner"):t.addClass("is-pending spinner")}};function d(e,t){const n=p(e);n&&(n.setValue(t),n.render())}function p(e){return n.currentPageView.getControlViewByName(e)}function u(e){const t=p(e);t&&t.el.scrollIntoView(!0)}window.TEAMTALLY[s].isRunning||(window.TEAMTALLY[s].isRunning=!0,n.el.addEventListener("click",(function(e){const t=e.target;function c(e){let t=!1;if(e.classList.contains("elementor-panel-tab-heading")){const n=i(e).closest(".elementor-control-edit_template_tab");if(n.length>0&&n[0]!==r){const e=decodeURIComponent(l.getSetting("chosen_template"));if(d("template_name",e),d("template_container",""),d("template_item",""),!e)return;m.enableTemplateEditing(!1),i.ajax({url:o,method:"POST",data:{action:"elementor_get_template",widget_name:s,template_name:e}}).done((function(t){if(t.success)d("template_name",e),d("template_container",t.container),d("template_item",t.item);else{const e=t.message;m.showTemplateNotice("notice-error",e),d("template_name",""),d("template_container",""),d("template_item","")}m.enableTemplateEditing(!0)})),t=!0}r=n[0]}return t}(n&&n.currentPageView&&n.currentPageView.model&&n.currentPageView.model.get("widgetType"))===s&&(c(t)||function(){let e=!1;if(t.classList.contains("elementor-button")&&i(t).closest(".elementor-control-template_btn_save").length>0){const t=l.getSetting("template_name"),n=l.getSetting("template_container"),c=l.getSetting("template_item"),r=a.nonce;m.enableTemplateEditing(!1),i.ajax({url:o,method:"POST",data:{action:"elementor_update_template",widget_name:s,template_name:t,template_container:n,template_item:c,_nonce:r}}).done((function(e){let t,n=e.message;a.nonce=e._nonce,e.success?(t="notice-success",m.updateTemplatesList(e.templates)):t="notice-error",m.showTemplateNotice(t,n),m.enableTemplateEditing(!0),u("template_section")})),e=!0}return e}()||function(){let e=!1;if(t.classList.contains("elementor-button")&&i(t).closest(".elementor-control-template_btn_remove").length>0){const t=l.getSetting("template_name"),n=a.nonce;m.enableTemplateEditing(!1),i.ajax({url:o,method:"POST",data:{action:"elementor_delete_template",widget_name:s,template_name:t,_nonce:n}}).done((function(e){let t,n=e.message;a.nonce=e._nonce,e.success?(t="notice-success",m.updateTemplatesList(e.templates)):t="notice-error",m.showTemplateNotice(t,n),d("template_name",""),d("template_container",""),d("template_item",""),m.enableTemplateEditing(!0);const o=p("use_template_tab"),i=o.$el.find(".elementor-panel-tab-heading");i.length&&(o.$el.trigger("click"),c(i[0])),u("template_section")})),e=!0}}())}),!1),n.el.addEventListener("click",(function(e){const t=e.target;if((n&&n.currentPageView&&n.currentPageView.model&&n.currentPageView.model.get("widgetType"))!==s)return;const o=i(t);if(!o.hasClass("elementor-section-title"))return!1;const a=o.closest(".elementor-control-type-section"),l=Array.from(a[0].classList).reduce(((e,t)=>{if(!~["elementor-control-type-section","elementor-control-separator-none","elementor-control"].indexOf(t)){const o=/^elementor\-control\-(.+)/i,i=t.match(o);if(i){const t=i[1],o=n.currentPageView.options.controls[t];o&&"section"===o.type&&(e=t)}}return e}),"");var c;l&&("template_section"===(c={el:a[0],sectionName:l,isOpened:!a.hasClass("elementor-open")}).sectionName&&setTimeout((()=>{m.activate(c)}),500))}),!0))}))})();